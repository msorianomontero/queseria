-- Database optional if already created
--CREATE DATABASE IF NOT EXISTS cheesedb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
--USE cheesedb;

CREATE TABLE IF NOT EXISTS cheeses (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    costprice DECIMAL(10,2) NOT NULL,
    sellprice DECIMAL(10,2) NOT NULL,
    active TINYINT(1) NOT NULL DEFAULT 1,
    createdat TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS stock (
    cheeseid INT PRIMARY KEY,
    units INT NOT NULL DEFAULT 0,
    CONSTRAINT fk_stock_cheese FOREIGN KEY (cheeseid) REFERENCES cheeses(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS deliveries (
    id INT AUTO_INCREMENT PRIMARY KEY,
    origin VARCHAR(100) NOT NULL,
    date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS del_detail (
    id INT AUTO_INCREMENT PRIMARY KEY,
    deliveryid INT NOT NULL,
    cheeseid INT NOT NULL,
    unitsreceived INT NOT NULL,
    owed DECIMAL(10,2) NOT NULL,
    paid DECIMAL(10,2) DEFAULT 0,
    FOREIGN KEY (deliveryid) REFERENCES deliveries(id) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (cheeseid) REFERENCES cheeses(id) ON UPDATE CASCADE ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS sales (
    id INT AUTO_INCREMENT PRIMARY KEY,
    customername VARCHAR(100) NOT NULL,
    cheeseid INT NOT NULL,
    unitssold INT NOT NULL,
    total DECIMAL(10,2) NOT NULL,
    date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_sales_cheese FOREIGN KEY (cheeseid) REFERENCES cheeses(id) ON UPDATE CASCADE ON DELETE RESTRICT
);
